<div class="outer-container">
  <div class="product-container" *ngIf="product$ | async as product">
    <div class="product-info">
      <div class="product-img">
        <img [src]="product.imageUrl" alt="" />
      </div>
      <div class="product-description">
        <form [formGroup]="adminForm">
          <h1 *ngIf="!updateMode">{{ product.name }}</h1>
          <input
            class="title"
            type="text"
            *ngIf="updateMode"
            formControlName="name"
          />
          <div *ngIf="!updateMode" style="margin-bottom: 30px; font-size: 15px">
            {{ product.description }}
          </div>
          <textarea
            class="description-textarea"
            *ngIf="updateMode"
            formControlName="description"
          >
          </textarea>

          <span class="rating-info">
            <app-rating [rating]="product?.review?.avgRating || 0"></app-rating>
            <span style="margin-left: 10px">{{
              "(" + (product?.review?.reviews?.length || "0") + ") reviews"
            }}</span>
          </span>
          <h2 *ngIf="!updateMode">{{ product.price | currency : "USD" }}</h2>
          <span style="display: flex" *ngIf="updateMode">
            <p class="price-input" style="border: none">$</p>
            <input
              type="number"
              step=".01"
              formControlName="price"
              class="price-input"
            />
          </span>
        </form>
        <span class="quantity" *ngIf="!isAdmin">
          <button
            (click)="updateQuantity('decrement')"
            [disabled]="this.quantity == minQuantity"
          >
            -
          </button>
          <input
            type="number"
            style="width: 30px; height: 30px; text-align: center"
            [(ngModel)]="quantity"
            [max]="maxQuantity"
            [min]="minQuantity"
          />
          <button
            [disabled]="this.quantity == maxQuantity"
            (click)="updateQuantity('increment')"
          >
            +
          </button>
        </span>
        <span *ngIf="isAdmin">
          <button *ngIf="!adminUpdating" (click)="wishToUpdate()">
            Update Information
          </button>
          <button *ngIf="adminUpdating" (click)="confirmUpdate()">
            Confirm Update
          </button>
        </span>
        <button
          *ngIf="!isAdmin"
          style="margin-left: 20px"
          class="button-basket"
          (click)="addToBasket(product)"
          routerLink="/basket"
        >
          Add to Basket {{ "(" + this.quantity + ")" }}
        </button>
      </div>
    </div>

    <!-- Review section -->

    <div class="review-container">
      <app-review [review]="product.review"></app-review>
    </div>
  </div>
</div>
